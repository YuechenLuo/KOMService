<html>
    <head>
        <title>Login Page</title>
        <!-- <link rel="stylesheet" type="text/css" href="css/login.css"> -->
        <link rel='stylesheet' href='https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css' integrity='sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO' crossorigin='anonymous'>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js' integrity='sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49' crossorigin='anonymous'></script>
        <script src='https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js' integrity='sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy' crossorigin='anonymous'></script>
        <style type="text/css">
            .login-signup-page {background-color:#ccf;}
            .form-container {
                background-color: #fff;
                width: 28rem;
                margin: 10rem auto;
                padding: 3rem;
            }
            .form-container h3 {
                margin-bottom: 1rem;
            }
            .forgot {
                margin: 1.5rem 0 0.8rem 0;
            }
            .iamlogin #signupButton, .iamlogin #loginPageButton, .iamlogin .signup-form {
                display: none;
            }
            .iamsignup #loginButton, .iamsignup #signupPageButton, .iamsignup .login-form {
                display: none;
            }
        </style>
        
    </head>
    <body class='login-signup-page'>
        <div class='form-container iamlogin'>
            <div class='login-form'>
                <h3>Login to PennCloud</h3>
                <p>Please enter your username and password</p>
                <div class='form-group'>
                    <input type='text' class='form-control' id='inputUsername' placeholder='Username'>
                </div>
                <div class='form-group'>
                    <input type='password' class='form-control' id='inputPassword' placeholder='Password'>
                </div>
                <div class='forgot'>
                    <a href='/reset_password'>Forgot password?</a>
                </div>
            </div>
            <div class='signup-form'>
                <h3>Signup to XXXCloud</h3>
                <p>Please enter your username and password</p>
                <div class='alert alert-danger password-match-err' role='alert'>
                    Passwords don't match.
                </div>
                <div class='form-group'>
                    <input type='text' class='form-control' id='signupUsername' placeholder='Username'>
                </div>
                <div class='form-group'>
                    <input type='password' class='form-control' id='signupPassword1' placeholder='Password'>
                </div>
                <div class='form-group'>
                    <input type='password' class='form-control' id='signupPassword2' placeholder='Repeat Password'>
                </div>
            </div>
            
            <div class='buttons-panel'>
                <button id='loginButton' class='btn btn-primary'>Login</button>
                <button id='signupButton' class='btn btn-primary'>Signup</button>
                <button id='loginPageButton' class='btn btn-info'>Go to Login</button>
                <button id='signupPageButton' class='btn btn-info'>Sign up</button>
            </div>
        </div>
        <!-- <script type="text/javascript" src="javascript/login.js"></script> -->
        <script type="text/javascript">
            $(document).ready(() => {
                $('.password-match-err').hide();
                $('#signupPageButton, #loginPageButton').click(() => {
                    if ($('.form-container').hasClass('iamlogin')) {
                        $('.form-container').removeClass('iamlogin');
                        $('.form-container').addClass('iamsignup');
                    } else {
                        $('.form-container').removeClass('iamsignup');
                        $('.form-container').addClass('iamlogin');
                    }
                });
                
                // When login button is clicked
                $('#loginButton').click(() => {
                    const loginUsername = $('#inputUsername').val();
                    const loginPswd = $('#inputPassword').val();

                    $.post('/login', JSON.stringify({username: loginUsername, pswd: loginPswd}))
                    .then((data) => {
                        console.log(data);
                        // data = $.parseJSON(data);
                        sessionStorage.setItem('penncloud_uid', data.username);
                        sessionStorage.setItem('penncloud_token', data.cookie);
                        window.location = "/dashboard"
                    }, (err) => {
                        alert('ERROR');
                        console.log(err);
                    });
                });
                
                // When signup button is clicked
                $('#signupButton').click(() => {
                    const signupUsername = $('#signupUsername').val();
                    const signupPswd1 = $('#signupPassword1').val();
                    const signupPswd2 = $('#signupPassword2').val();
                    if (signupPswd1 !== signupPswd2) $('.password-match-err').show();
                    // TODO: send POST /login
                    $.post('/signup', JSON.stringify({username: signupUsername, pswd: signupPswd1}))
                    .then((data) => {
                        data = $.parseJSON(data);
                        sessionStorage.setItem('penncloud_uid', data.username);
                        sessionStorage.setItem('penncloud_token', data.cookie);
                        window.location = "/dashboard"
                    }, (err) => {
                        alert('ERROR');
                        console.log(err);
                    })
                    
                });
            });
        </script>
    </body>
</html>
